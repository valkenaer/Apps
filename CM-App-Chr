Import-Module $env:SMS_ADMIN_UI_PATH.Replace("\bin\i386","\bin\configurationmanager.psd1")
$SiteCode = Get-PSDrive -PSProvider CMSITE
Set-Location "$($SiteCode.Name):\"

$SiteServer = $Env:COMPUTERNAME

    $AppVer      = "143.0.7499.41"
    $VerMinOne   = "142.0.7444.176"


$MSILocation     = "\\SiteServer$\Sources$\Applications\Google\$AppVer\googlechromestandaloneenterprise64.msi"
$Manu            = "Google"
$AppName         = "Chrome"
$AppDesc         = "Chrome Enterprise offers scalable security, additional controls, customizable policies, and effortless integration of all the tools users already know and love."
$Purp            = "Required"
$DPGName         = "BSC_DPG"
$ConsoleFolderPath = "\Applications\Productivity Tools"
$AppFullName     = "$Manu $AppName $AppVer"
$PrevVersion     = "$Manu $AppName $VerMinOne"

   $DevColl01         = "Workstation Windows 10 version 22H2"
   $DevColl02         = "Workstation Windows 11 version 24H2"
   $DevColl03         = "Computer All Physical (incl Spark)"


If (Get-CMApplication $PrevVersion) {

    Remove-CMApplicationDeployment -Name $PrevVersion -CollectionName $DevColl01 -Force
    Remove-CMApplicationDeployment -Name $PrevVersion -CollectionName $DevColl02 -Force
    Remove-CMApplicationDeployment -Name $PrevVersion -CollectionName $DevColl03 -Force
    Remove-CMApplication $PrevVersion -Force

}


New-CMApplication -Name $AppFullName -Description $AppDesc -Publisher $Manu -SoftwareVersion $ExpectedVersion 
Add-CMMSIDeploymentType -ApplicationName $AppFullname -ContentLocation $MSILocation -InstallationBehaviorType InstallForSystem -Force -UserInterActionMode Hidden
Start-CMContentDistribution -ApplicationName $AppFullName -DistributionPointGroupName $DPGName


New-CMApplicationDeployment -CollectionName $DevColl01 -Name $AppFullName -DeployAction Install -DeployPurpose $Purp -UserNotification HideAll -AvailableDateTime (get-date) -TimeBaseOn LocalTime -Verbose
New-CMApplicationDeployment -CollectionName $DevColl02 -Name $AppFullName -DeployAction Install -DeployPurpose $Purp -UserNotification HideAll -AvailableDateTime (get-date) -TimeBaseOn LocalTime -Verbose
New-CMApplicationDeployment -CollectionName $DevColl03 -Name $AppFullName -DeployAction Install -DeployPurpose $Purp -UserNotification HideAll -AvailableDateTime (get-date) -TimeBaseOn LocalTime -Verbose

$MoveApp = Get-CMApplication -Name $AppFullName

If($ConsoleFolderPath) {
    $MoveApp | Move-CMObject -FolderPath "$($SiteCode):\Application$($ConsoleFolderPath)"
}

